webpackJsonp([3],{"7mze":function(e,t){},OAwK:function(e,t){},o5rQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("4YfN"),s=a.n(o),r=a("/o5o"),l=a("cMGX"),i=a("9rMa"),n={data:function(){var e=this;return{total:0,pageCount:1,currentPage:1,pageSize:10,loadingFlag:!1,userInfoForm:{avatar:"",username:"",job:"",address:"",tel:"",email:""},userImageUrl:"",multipleSelection:[],addUserForm:{account:"",username:"",pass:"",checkPass:""},users:[],modifyPwdForm:{pass:"",checkPass:""},rules:{account:[{validator:function(e,t,a){""===t?a(new Error("帐号不能为空")):a()},trigger:"blur"}],username:[{validator:function(e,t,a){""===t?a(new Error("用户名不能为空")):a()},trigger:"blur"}],pass:[{validator:function(t,a,o){""===a?o(new Error("请输入密码")):(""!==e.modifyPwdForm.checkPass?e.$refs.modifyPwdForm.validateField("checkPass"):""!==e.addUserForm.checkPass&&e.$refs.addUserForm.validateField("checkPass"),o())},trigger:"blur"}],checkPass:[{validator:function(t,a,o){var s=""===e.modifyPwdForm.pass?e.addUserForm.pass:e.modifyPwdForm.pass;""===a?o(new Error("请再次输入密码")):a!==s?o(new Error("两次输入密码不一致!")):o()},trigger:"blur"}]},tempId:"",infoId:"",userId:"",userInfoModalFlag:!1,removeModalFlag:!1,pwdModalFlag:!1,editModalFlag:!1,addModalFlag:!1,tableData:[],roleForm:{role:""},formLabelWidth:"120px"}},computed:s()({},Object(i.c)(["role"]),{userRole:function(){return this.$store.state.role}}),mounted:function(){this.loadingUser(),this.tableTotal()},watch:{immediate:!0},methods:{loadingUser:function(){var e=this;this.loadingFlag=!0,this.$ajax.get("/users/").then(function(t){e.loadingFlag=!1;var a=t.data;e.getUserData(a)})},tableTotal:function(){var e=this;this.$ajax.get("/users/total").then(function(t){e.total=t.data.total})},clickpageNum:function(e){var t=this;this.loadingFlag=!0,this.currentPage=e,this.$ajax.get("/users/page/"+this.currentPage+"/size/"+this.pageSize,{params:{page:this.currentPage,size:this.pageSize}}).then(function(e){t.loadingFlag=!1;var a=e.data.result;t.tableData=a})},getUserData:function(e){var t=[],a="";if(200===e.status){this.users=e.result;for(var o=0;o<this.users.length;o++){var s={};switch(this.users[o].role){case 0:a="普通用户";break;case 1:a="邮件激活后的用户";break;case 2:a="会计";break;case 3:a="采购";break;case 6:a="国内销售";break;case 8:a="国外销售";break;case 10:a="管理";break;case 50:a="超级管理员"}s.id=this.users[o]._id,s.account=this.users[o].account,s.infoId=this.users[o].info._id,s.username=this.users[o].info.username,s.role=a,t[o]=s}this.tableData=t}},addNewUser:function(){var e=this;this.addUserForm.pass===this.addUserForm.checkPass?this.$ajax.post("/users/add",{account:this.addUserForm.account,password:this.addUserForm.checkPass}).then(function(t){"1"===t.data.status?(e.$message({message:t.data.msg,type:"success"}),e.loadingUser(),e.addModalFlag=!1,e.resetForm("addUserForm")):e.$message.error(t.data.msg)}):this.$message({message:"两次密码输入不一致,请重新输入",type:"error"})},showRemoveModal:function(e,t){this.removeModalFlag=!0,this.tempId=t.id},handleSelectionChange:function(e){this.multipleSelection=e},handleDelete:function(){var e=this;this.tempId===this.$store.state.userId?(this.$message.error("用户删除失败"),this.removeModalFlag=!1):this.$ajax.delete("/users/del/"+this.tempId,{params:{id:this.tempId}}).then(function(t){"1"===t.data.status?(e.$message({message:t.data.msg,type:"success"}),e.loadingUser(),e.removeModalFlag=!1):(e.$message.error(t.data.msg),e.removeModalFlag=!1)})},showInfoModal:function(e,t){this.userInfoModalFlag=!0,this.userId=t.id,this.infoId=t.infoId,this.showUserInfo(t)},showUserInfo:function(e){var t=this;this.$ajax.get("/users/userInfo/"+e.infoId).then(function(a){if(console.log("get id   "+e.infoId),"1"===a.data.status){var o=a.data.result;console.log("formData  "+o),t.userImageUrl=o.avatar,t.userInfoForm.username=o.username,t.userInfoForm.job=o.job,t.userInfoForm.address=o.address,t.userInfoForm.tel=o.tel,t.userInfoForm.email=o.email}})},handleAvatarSuccess:function(e,t){this.userImageUrl=URL.createObjectURL(t.raw)},beforeAvatarUpload:function(e){this.userInfoForm.avatar=e;var t=e.size/1024/1024<2;return t||this.$message.error("上传头像图片大小不能超过 2MB!"),t},updateInfo:function(){var e=this;this.userInfoForm.infoId=this.$store.state.infoId,console.log("post id  "+this.infoId),this.$ajax.post("/users/userInfo/"+this.infoId,this.userInfoForm).then(function(t){console.log(t.data.status),"1"===t.data.status&&(e.$message({message:t.data.msg,type:"success"}),e.$store.commit("SET_USERNAME",t.data.result.username),e.userInfoModalFlag=!1)})},showPwdModal:function(e,t){this.pwdModalFlag=!0,this.tempId=t.id},handleModify:function(){var e=this;""!==this.modifyPwdForm.pass&&""!==this.modifyPwdForm.checkPass&&this.modifyPwdForm.pass===this.modifyPwdForm.checkPass?this.$ajax.post("/users/modify/psd",{id:this.tempId,password:this.modifyPwdForm.checkPass}).then(function(t){console.log("修改密码："+t.data.status),"1"===t.data.status?(e.$message({message:t.data.msg,type:"success"}),e.pwdModalFlag=!1,e.resetForm("modifyPwdForm")):e.$message.error(t.data.msg)}):this.$message({message:"两次密码输入不一致,请重新输入",type:"error"})},showRoleModal:function(e,t){this.role<50?this.$message.error("权限不够，不能设置"):(this.editModalFlag=!0,this.tempId=t.id,this.roleForm.role=t.role)},modifyRole:function(){var e=this;this.$ajax.post("/users/modify/role",{role:this.roleForm.role,id:this.tempId}).then(function(t){"1"===t.data.status?(e.$message({message:t.data.msg,type:"success"}),e.loadingUser(),e.editModalFlag=!1):e.$message({message:t.data.msg,type:"error"}),e.editModalFlag=!1,e.roleForm.role=""})},modalChange:function(){this.pwdModalFlag=!1,this.editModalFlag=!1,this.addModalFlag=!1,this.removeModalFlag=!1,this.userInfoModalFlag=!1},resetForm:function(e){this.$refs[e].resetFields()}},components:{modal:r.a,pagination:l.a}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticClass:"source"},[a("el-col",{attrs:{span:1,offset:10}},[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){e.addModalFlag=!0}}},[e._v("添加")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFlag,expression:"loadingFlag"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading",data:e.tableData,stripe:""},on:{"selection-change":e.handleSelectionChange}},[e._v(">\n    "),a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"account",label:"登录帐号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"account",label:"名字"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role",label:"角色权限"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.showInfoModal(t.$index,t.row)}}},[e._v("员工资料")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){e.showPwdModal(t.$index,t.row)}}},[e._v("重设密码")]),e._v(" "),a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){e.showRoleModal(t.$index,t.row)}}},[e._v("权限设置")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){e.showRemoveModal(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("pagination",{attrs:{total:e.total,pageCount:e.pageCount,currentPage:e.currentPage,pageSize:e.pageSize},on:{clickpageNum:e.clickpageNum}}),e._v(" "),a("modal",{attrs:{dialogFormVisible:e.editModalFlag,title:"权限信息"},on:{modalToggle:e.modalChange}},[a("el-form",{attrs:{slot:"content",model:e.roleForm},slot:"content"},[a("el-form-item",{attrs:{label:"权限设置","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"选择用户的权限"},model:{value:e.roleForm.role,callback:function(t){e.$set(e.roleForm,"role",t)},expression:"roleForm.role"}},[a("el-option",{attrs:{label:"普通用户",value:"0"}}),e._v(" "),a("el-option",{attrs:{label:"邮件激活后的用户",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"高级用户",value:"2"}}),e._v(" "),a("el-option",{attrs:{label:"采购",value:"3"}}),e._v(" "),a("el-option",{attrs:{label:"国内销售",value:"6"}}),e._v(" "),a("el-option",{attrs:{label:"国外销售",value:"8"}}),e._v(" "),a("el-option",{attrs:{label:"管理员",value:"10"}}),e._v(" "),a("el-option",{attrs:{label:"超级管理员",value:"50"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.modalChange}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.modifyRole}},[e._v("确 定")])],1)],1),e._v(" "),a("modal",{attrs:{dialogFormVisible:e.pwdModalFlag,title:"修改密码"},on:{modalToggle:e.modalChange}},[a("el-form",{ref:"modifyPwdForm",staticClass:"demo-ruleForm",attrs:{slot:"content",model:e.modifyPwdForm,"status-icon":"",rules:e.rules,"label-width":"100px"},slot:"content"},[a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.modifyPwdForm.pass,callback:function(t){e.$set(e.modifyPwdForm,"pass",t)},expression:"modifyPwdForm.pass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.modifyPwdForm.checkPass,callback:function(t){e.$set(e.modifyPwdForm,"checkPass",t)},expression:"modifyPwdForm.checkPass"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleModify}},[e._v("确 定")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.resetForm("modifyPwdForm")}}},[e._v("重 置")])],1)],1),e._v(" "),a("modal",{attrs:{dialogFormVisible:e.addModalFlag,title:"添加用户"},on:{modalToggle:e.modalChange}},[a("el-form",{ref:"addUserForm",staticClass:"demo-ruleForm",attrs:{slot:"content",model:e.addUserForm,"status-icon":"",rules:e.rules,"label-width":"100px"},slot:"content"},[a("el-form-item",{attrs:{label:"帐号名",prop:"account"}},[a("el-input",{attrs:{type:"text","auto-complete":"off"},model:{value:e.addUserForm.account,callback:function(t){e.$set(e.addUserForm,"account",t)},expression:"addUserForm.account"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.addUserForm.pass,callback:function(t){e.$set(e.addUserForm,"pass",t)},expression:"addUserForm.pass"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.addUserForm.checkPass,callback:function(t){e.$set(e.addUserForm,"checkPass",t)},expression:"addUserForm.checkPass"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.addNewUser}},[e._v("确 定")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.resetForm("addUserForm")}}},[e._v("重 置")])],1)],1),e._v(" "),a("modal",{attrs:{dialogFormVisible:e.removeModalFlag},on:{modalToggle:e.modalChange}},[a("p",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"content"},slot:"content"},[e._v("\n      是否删除用户？\n    ")]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.modalChange}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:e.handleDelete}},[e._v("确 定")])],1)]),e._v(" "),a("modal",{attrs:{dialogFormVisible:e.userInfoModalFlag,title:"查看员工信息"},on:{modalToggle:e.modalChange}},[a("el-form",{ref:"userInfoForm",attrs:{slot:"content",model:e.userInfoForm,"label-width":e.formLabelWidth},slot:"content"},[a("el-form-item",{attrs:{label:"上传头像"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/users/update/userInfo","show-file-list":!1,headers:{flag:!0},"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.userImageUrl?a("img",{staticClass:"avatar",attrs:{src:e.userImageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{model:{value:e.userInfoForm.username,callback:function(t){e.$set(e.userInfoForm,"username",t)},expression:"userInfoForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"职业"}},[a("el-input",{model:{value:e.userInfoForm.job,callback:function(t){e.$set(e.userInfoForm,"job",t)},expression:"userInfoForm.job"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"居住地"}},[a("el-input",{model:{value:e.userInfoForm.address,callback:function(t){e.$set(e.userInfoForm,"address",t)},expression:"userInfoForm.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话"}},[a("el-input",{model:{value:e.userInfoForm.tel,callback:function(t){e.$set(e.userInfoForm,"tel",t)},expression:"userInfoForm.tel"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱"}},[a("el-input",{model:{value:e.userInfoForm.email,callback:function(t){e.$set(e.userInfoForm,"email",t)},expression:"userInfoForm.email"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger","native-type":"reset"}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.updateInfo}},[e._v("保存")])],1)],1)],1)},staticRenderFns:[]};var m=a("46Yf")(n,d,!1,function(e){a("7mze"),a("OAwK")},"data-v-b42080ca",null);t.default=m.exports}});
//# sourceMappingURL=3.43cea942bba4c29c3ac4.js.map